<!DOCTYPE html>
{% extends 'layout.html' %}
{% load static %}

{% block title %}YouBuild | Home {% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'resultadosVacios.css' %}" /> 
<link rel="stylesheet" href="{% static 'style.css' %}" /> 
<link rel="stylesheet" href="{% static 'listaProduct.css' %}" /> 
<link rel="stylesheet" href="{% static 'topbar.css' %}" /> 
<link rel="stylesheet" href="{% static 'categorization.css' %}" /> <!-- Agregado: CSS de categorization -->
{% endblock %}


{% block content %}
<main>
  <!-- Filtros de productos -->
  <div class="filter-container">
    <!-- Categorías -->
    <div class="filter-group">
      <button class="filter-button" id="categoryBtn">
        Categorías <i class="fas fa-chevron-down"></i>
      </button>
      <div class="filter-dropdown" id="categoryDropdown">
        <label><input type="checkbox" value="madera"> Madera</label>
        <label><input type="checkbox" value="arena"> Arena</label>
        <label><input type="checkbox" value="cemento"> Cemento</label>
        <label><input type="checkbox" value="otros"> Otros</label>
      </div>
    </div>

    <!-- Precio -->
    <div class="filter-group">
      <button class="filter-button" id="priceBtn">
        Precio <i class="fas fa-chevron-down"></i>
      </button>
      <div class="filter-dropdown" id="priceDropdown">
        <label><input type="radio" name="price" value="0-100"> Bs 0 - 100</label>
        <label><input type="radio" name="price" value="101-500"> Bs 101 - 500</label>
        <label><input type="radio" name="price" value="501-1000"> Bs 501 - 1000</label>
        <label><input type="radio" name="price" value="1001+"> Bs 1001+</label>
      </div>
    </div>

    <!-- Ordenar -->
    <div class="filter-group">
      <button class="filter-button" id="sortBtn">
        Ordenar <i class="fas fa-chevron-down"></i>
      </button>
      <div class="filter-dropdown" id="sortDropdown">
        <label><input type="radio" name="sort" value="price-asc"> Precio: Menor a Mayor</label>
        <label><input type="radio" name="sort" value="price-desc"> Precio: Mayor a Menor</label>
        <label><input type="radio" name="sort" value="name-asc"> Nombre: A-Z</label>
        <label><input type="radio" name="sort" value="name-desc"> Nombre: Z-A</label>
      </div>
    </div>

    <!-- Restablecer Filtros -->
    <button class="reset-button" id="resetFilters">
      Restablecer Filtros
    </button>
  </div>

  

  <!-- Carrusel de productos -->
  <div class="carousel-container">
    <div class="carousel">
      {% for carrusel_item in carrusel %}
      <div class="carousel-item">
        <img src="{{ carrusel_item.imagen.url }}" alt="Imagen del carrusel" />
      </div>
      {% endfor %}
    </div>
    <button class="carousel-button prev">
      <i class="fas fa-chevron-left"></i>
    </button>
    <button class="carousel-button next">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>

  <div class="carousel-dots"></div>

  <!-- Lista de productos disponibles -->
  <h2 class="products-title">Productos Disponibles</h2>
  <div class="products-container grid-view">
    {% for producto in producto %}
    <div class="product" data-category="{{ producto.categoria }}" data-price="{{ producto.precio }}">
      <img src="{{ producto.imagenes.first.imagen.url }}" alt="{{ producto.nombre }}" />
      <h3>{{ producto.nombre }}</h3>
      <p>Bs {{ producto.precio }}</p>
      <div class="buttons-container">
        <div class="button-row">
          <button class="btn buy-now">Comprar Ahora</button>
          <button class="btn add-to-cart" onclick="agregarAlCarrito({{ producto.id }})">
            <i class="fas fa-shopping-cart"></i> Agregar a Carrito
          </button>
        </div>
        <div class="button-row">
          <button class="btn add-to-view" onclick="verDetalles({{ producto.id }})">
            <i class="fas fa-eye"></i> Ver Detalles
          </button>
          <button class="btn add-to-list">
            <i class="fas fa-heart"></i> Agregar a Lista
          </button>
        </div>
      </div>
    </div>
    {% empty %}
    <div class="mi-no-results">
      <img src="{% static 'notFounded.png' %}" alt="LogoNotFounded" width="125">
      <p>No se encontraron productos relacionados con tu búsqueda.</p>
      <div class="mi-button-row">
        <a href="{% url 'index' %}" class="mi-btn">Volver a la Página de Inicio</a>
      </div>
    </div>
    {% endfor %}
  </div>
</main>
{% endblock %}


{% block extra_scripts %}
<script src="{% static 'script.js' %}"></script>
<script src="{% static 'categorization.js' %}"></script> <!-- Agregado: JS de categorization -->
<script>
  function agregarAlCarrito(productId) {
    fetch(`/agregar-al-carrito/${productId}/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({})
    })
    .then(response => {
        if (response.redirected) {
            window.location.href = response.url;
        } else {
            return response.json();
        }
    })
    .then(data => {
        if (data && data.success) {
            alert(data.message || 'Producto agregado correctamente al carrito');
        } else if (data && data.message) {
            alert(data.message || 'Error al agregar el producto al carrito');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error al agregar al carrito');
    });
  }
</script>
{% endblock %}
